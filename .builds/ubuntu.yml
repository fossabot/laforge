image: ubuntu/latest
environment:
  LANG: C.UTF-8
  LC_ALL: C.UTF-8
  PYTHONIOENCODING: UTF-8
packages:
  - python3
  - python3-pip
  - python3-setuptools
  - python3-numpy
sources:
  - https://git.sr.ht/~matvan/laforge
tasks:
  - install: |
        cat ~/.buildenv
        cd laforge
        python3 -m pip install --user --upgrade pip
        python3 -m pip -V
        python3 -m pip install --user --upgrade setuptools
        python3 -m pip install --user -q -r requirements.txt
        python3 -m pip install --user -q -e .[ci]
  - pytest: |
        cd laforge
        python3 -c "import sys; print(sys.stdout.encoding); import pandas; print(pandas.get_option('display.encoding'))"
        python3 -m pytest -x -rs
  - black: |
        cd laforge
        python3 -m black --version
        python3 -m black --diff ./laforge
  - flake8: |
        cd laforge
        python3 -m flake8 --version
        python3 -m flake8 ./laforge
  - pylint: |
        cd laforge
        python3 -m pylint --version
        python3 -m pylint --disable=R,C ./laforge
  - cli: |
        export LANG=C.UTF-8
        export LC_ALL=C.UTF-8
        python3 -m laforge --version
